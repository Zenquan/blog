## 性能优化

网络层

[happypack](https://github.com/amireh/happypack#how-it-works)

```
npm install --save-dev happypack
```

**HappyPack provides both a plugin and a loader in order to do its job so you must use both to enable it.**

环境：

- webpack4
- windows10

在vue项目里build目录下，webpack.base.conf.js使用

```javascript
const HappyPack = require('happypack');

exports.module = {
  rules: [
    {
      test: /.js$/,
      // 1) replace your original list of loaders with "happypack/loader":
      // loaders: [ 'babel-loader?presets[]=es2015' ], 
      use: 'happypack/loader',
      include: [ /* ... */ ],
      exclude: [ /* ... */ ]
    }
  ]
};

exports.plugins = [
  // 2) create the plugin:
  new HappyPack({
    // 3) re-add the loaders you replaced above in #1:
    loaders: [ 'babel-loader?presets[]=es2015' ]
  })
];
```



实际项目

```javascript
// @file: webpack.config.js
const HappyPack = require('happypack');
const happyThreadPool = HappyPack.ThreadPool({ size: os.cpus().length });

exports.module = {
  rules: [
    {
        test: /\.js$/,
        loader: 'happypack/loader?id=happy-babel-js',
        exclude: /node_modules/,
        include: [resolve('src')]
      },
      {
        test: /\.svg$/,
        loader: 'happypack/loader?id=happy-svg',
        include: [resolve('src/assets/icons'), resolve('src/assets/images')]
      },
  ]
};

exports.plugins = [
  // 2) create the plugin:
  new ProgressBarPlugin({
      format: '  build [:bar] ' + chalk.green.bold(':percent') + ' (:elapsed seconds)'
    }),
    new webpack.DllReferencePlugin({
      context: path.resolve(__dirname, '..'),
      manifest: require('./vendor-manifest.json')
    }),
    createHappyPlugin('happy-babel-js', ['babel-loader?cacheDirectory=true']),
    createHappyPlugin('happy-babel-vue', ['babel-loader?cacheDirectory=true']),
    createHappyPlugin('happy-css', ['css-loader', 'vue-style-loader']),
    createHappyPlugin('happy-svg', ['svg-sprite-loader']),
    // https://github.com/amireh/happypack/pull/131
    new HappyPack({
      loaders: [{
        path: 'vue-loader',
        query: {
          loaders: {
            scss: 'vue-style-loader!css-loader!sass-loader?indentedSyntax'
          }
        }
      }]
    }),
    new HardSourceWebpackPlugin(),
    new webpack.LoaderOptionsPlugin({ options: {} })
];
```

